{% extends 'records/base.html' %}

{% block title %}Intentos de Registros Duplicados{% endblock %}

{% block content %}
    <h2>Intentos de Registros Duplicados</h2>

    <a href="{% url 'duplicate_attempts_history_list' %}">Ver Historial Completo</a>
    <br><br>

    <table border="1">
        <thead>
            <tr>
                <th>Usuario</th>
                <th>Fecha y Hora</th>
                <th>Tipo de Intento</th> {# NUEVO: Columna para el tipo de intento #}
                <th>Datos del Intento</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for attempt in attempts %}
            <tr>
                <td>{{ attempt.user.username }}</td>
                <td>{{ attempt.timestamp|date:"d/m/Y H:i:s" }}</td>
                <td>{{ attempt.get_attempt_type_display }}</td> {# NUEVO: Mostrar el tipo de intento #}
                <td>
                    <ul>
                        {% for key, value in attempt.data.items %}
                            <li><strong>{{ key }}:</strong> {{ value }}</li>
                        {% endfor %}
                    </ul>
                </td>
                <td>
                    <a href="{% url 'resolve_duplicate_attempt' attempt.pk %}">Marcar como Resuelto</a>
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="5">No hay intentos de registros duplicados.</td></tr> {# ACTUALIZADO: colspan a 5 #}
            {% endfor %}
        </tbody>
    </table>

    {% if is_paginated %}
      <div>
        {% if page_obj.has_previous %}
          <a href="?page={{ page_obj.previous_page_number }}">Anterior</a>
        {% endif %}
        <span>PÃ¡gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}</span>
        {% if page_obj.has_next %}\
          <a href="?page={{ page_obj.next_page_number }}">Siguiente</a>
        {% endif %}
      </div>
    {% endif %}
{% endblock %}